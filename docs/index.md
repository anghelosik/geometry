# Geometry Project — Documentation

**Version:** 1.0  
**Language:** Python 3.x  
**Author:** gagli  
**Project path:** `mypythonproject/geometry/`

---

## Table of Contents

1. [Project description](#1-project-description)
2. [The mathematical question](#2-the-mathematical-question)
3. [Project structure](#3-project-structure)
4. [Installation and setup](#4-installation-and-setup)
5. [Quick-start guide](#5-quick-start-guide)
6. [Main module: square_points.py](#6-main-module-square_pointspy)
7. [Analysis script: distance_analysis.py](#7-analysis-script-distance_analysispy)
8. [Entry point: main.py](#8-entry-point-mainpy)
9. [Test suite](#9-test-suite)
10. [Available documentation](#10-available-documentation)
11. [Useful commands (Makefile)](#11-useful-commands-makefile)
12. [Technical notes and fixed bugs](#12-technical-notes-and-fixed-bugs)

---

## 1. Project Description

The **geometry** project is a computational and probabilistic study on the sampling
of random points on the perimeter of a square. The core of the project is the module
`square_points.py`, which implements **9 distinct methods** for generating a pair of
distinct points on the perimeter of a square with side length L > 0.

The project was conceived as an exercise in comparing algorithms: algorithms that are
mathematically equivalent in their specification but differ in implementation, and
algorithms that — while appearing similar — sample different probability distributions,
leading to different statistical results.

---

## 2. The Mathematical Question

> **Given a square with side length L > 0, what is the probability that two points
> chosen at random on its perimeter have Euclidean distance greater than L?**

The answer depends critically on what "chosen at random" means. The project
demonstrates empirically that different distributions produce different answers:

| Sampling distribution                        | P(d > L)    | Methods |
|----------------------------------------------|-------------|---------|
| Uniform on the perimeter                     | **≈ 35.7%** | `sample_parametric`, `sample_by_side`, `sample_by_edge_label`, `sample_side_pos`, `sample_parametric_modular`, `sample_cartesian` |
| Uniform over the polar angle from the centre | ≈ 33.9%     | `sample_polar_ray`, `sample_polar_angle` |
| Projection of an interior point              | ≈ 29.8%     | `sample_interior_projection` |

The exact theoretical value for the uniform distribution on the perimeter is
**P(d > L) ≈ 0.3573**, computable analytically by integration.
Numerical results with 1 000 000 iterations converge to this value with an error
below 0.2 percentage points.

For a detailed analysis, see [`distance_analysis_report.md`](distance_analysis_report.md).

---

## 3. Project Structure

```
geometry/
│
├── square_points.py          # Main module: 9 sampling methods
├── distance_analysis.py      # Comparative statistical analysis of the 9 methods
├── main.py                   # Entry point: demo and visual test of all methods
│
├── core/
│   ├── __init__.py
│   └── base.py               # Abstract base classes for the project
│
├── models/
│   ├── __init__.py
│   └── shapes.py             # Geometric models (Square, Point, etc.)
│
├── utils/
│   ├── __init__.py
│   └── helpers.py            # General utility functions
│
├── tests/
│   ├── __init__.py
│   ├── test_square_points.py # Main test suite (pytest)
│   ├── fixtures/
│   │   └── __init__.py
│   ├── integration/
│   │   └── test_workflow.py  # End-to-end integration tests
│   └── unit/
│       └── test_shapes.py    # Unit tests for geometric models
│
├── docs/
│   ├── index.md                      # This file
│   └── distance_analysis_report.md   # Report on the analysis results
│
├── examples/
│   └── basic_usage.py        # API usage examples
│
├── config/
│   └── settings.yaml         # Configuration parameters
│
├── scripts/
│   ├── run_tests.bat          # Run the test suite on Windows
│   └── run_tests.sh           # Run the test suite on Linux/macOS
│
├── output/
│   └── plots/                 # Directory for plot outputs (generated by analysis)
│
├── notebooks/
│   └── README.md              # Notes for Jupyter notebooks
│
├── .venv/                     # Python virtual environment (not versioned)
├── requirements.txt           # Python dependencies for the project
├── setup.py                   # Optional packaging configuration
├── Makefile                   # Automation of the main commands
├── .gitignore                 # Files and directories excluded from version control
├── README.md                  # Short project description (root)
└── Structure.txt              # Structure documentation (legacy)
```

---

## 4. Installation and Setup

### Prerequisites

- Python 3.8 or higher
- pip

### Creating and activating the virtual environment

**Windows:**
```bat
cd mypythonproject\geometry
python -m venv .venv
.venv\Scripts\activate
```

**Linux / macOS:**
```bash
cd mypythonproject/geometry
python3 -m venv .venv
source .venv/bin/activate
```

### Installing dependencies

```bash
pip install -r requirements.txt
```

The project dependencies include `pytest` for testing and `colorama` for
coloured terminal output.

---

## 5. Quick-Start Guide

### Running the main demo

```bash
python main.py
```

Runs all 9 methods on a square with side L = 10, prints the generated points,
the distribution across sides, and a comparative report.

### Running the statistical analysis

```bash
python distance_analysis.py --iterations 100000 --L 10
```

Available parameters:

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `--iterations` / `-n` | int (or list) | 100 | Number of iterations. Multiple values produce multiple tables |
| `--L` | float | 10.0 | Square side length |
| `--csv` | string | none | Path to CSV output file |

Examples:

```bash
# Single analysis with 1 million iterations
python distance_analysis.py -n 1000000 --L 1000

# Analysis with multiple iteration counts in one run
python distance_analysis.py -n 1000 10000 100000 --L 10

# Export results to CSV
python distance_analysis.py -n 100000 --L 10 --csv output/results.csv
```

### Using the methods directly from code

```python
from square_points import (
    sample_parametric,
    sample_by_side,
    sample_interior_projection,
)

L = 10.0

# Each method returns a pair of (x, y) tuples
p1, p2 = sample_parametric(L)
print(f"Point 1: {p1}")
print(f"Point 2: {p2}")
```

---

## 6. Main Module: square_points.py

The module exposes 9 public functions, all with the same signature:

```python
def <method_name>(L: float) -> Tuple[Tuple[float, float], Tuple[float, float]]
```

Each function returns two distinct points `(x, y)` on the perimeter of the
square `[0, L] × [0, L]`.

### Internal helper functions

**`_perimeter_to_xy(t, L)`** — converts a scalar parameter `t ∈ [0, 4L)` to
`(x, y)` coordinates on the perimeter, traversing the four sides counter-clockwise
starting from the bottom-left corner.

**`_is_distinct(p1, p2, tol=1e-12)`** — returns `True` if the two points differ
by more than the specified numerical tolerance. Used internally for rejection
sampling.

### The 9 methods

| Function | Descriptive name | Distribution | Notes |
|----------|-----------------|--------------|-------|
| `sample_parametric` | Linear perimeter parametrization | **Uniform** | Parameter `t ∈ [0, 4L)`, rejection if coincident |
| `sample_by_side` | Side selection | **Uniform** | Picks the side, then a uniform coordinate; **bug fixed** (see §12) |
| `sample_by_edge_label` | Edge labels (x0/xL/y0/yL) | **Uniform** | Equivalent to `sample_parametric` and `sample_by_side` |
| `sample_polar_ray` | Ray from center (polar angle) | Non-uniform | Uniform polar angle → over-representation of corners |
| `sample_side_pos` | Side + position | **Uniform** | Rejection on identical (side, coordinate) pair |
| `sample_parametric_modular` | Parametrization (modular variant) | **Uniform** | Uses `_perimeter_to_xy`; cleaner implementation |
| `sample_cartesian` | Cartesian boundary | **Uniform** | Fixes x or y at random, samples the other |
| `sample_polar_angle` | Polar angle (simplified) | Non-uniform | Equivalent to `sample_polar_ray`; more concise |
| `sample_interior_projection` | Interior projection | Non-uniform | Interior point → projected onto nearest side; concentrates at side midpoints |

### Distance distribution summary (1M iterations, L = 1000)

```
sample_parametric, sample_by_side, sample_by_edge_label,
sample_side_pos, sample_parametric_modular, sample_cartesian
    → P(d > L) ≈ 35.7%   mean ≈ 735   Max ≈ 1414 (≈ √2·L)

sample_polar_ray, sample_polar_angle
    → P(d > L) ≈ 33.9%   mean ≈ 719

sample_interior_projection
    → P(d > L) ≈ 29.8%   mean ≈ 687   Max ≈ 1397 (does not reach √2·L)
```

---

## 7. Analysis Script: distance_analysis.py

Runs all 9 methods in parallel (same iteration) and compares the produced distances.
The output table includes the following columns:

| Column | Description |
|--------|-------------|
| `Count` | Number of iterations with distance > L |
| `Attempts` | Total valid iterations (exceptions excluded) |
| `>L %` | Percentage Count/Attempts |
| `Mean` | Mean distance (3 decimal places) |
| `Std` | Standard deviation (3 decimal places) |
| `Min` | Minimum observed distance |
| `Max` | Maximum observed distance |
| `#Shortest` | How many times the method produced the **minimum** distance in the iteration |
| `#Longest` | How many times the method produced the **maximum** distance in the iteration |

The `#Shortest` and `#Longest` columns compare the 9 methods within the same iteration
and are the most sensitive tool for detecting systematic differences between distributions.

---

## 8. Entry Point: main.py

Runs an interactive demo that for each method:

1. generates `iterations` point pairs (default 1000)
2. verifies that each point lies on the perimeter within a tolerance of 1e-9
3. verifies the distinctness of the two points
4. prints the distribution of points across the four sides
5. produces a final comparative report across all methods

Expected output: all 9 methods pass all checks with status `[OK]`.

> **Note:** `main.py` still uses the original Italian-style function names
> (`metodo1` … `metodo6_proiezione`) from the project's initial version.
> If you replace `square_points.py` with the current version, update the
> imports in `main.py` accordingly.

---

## 9. Test Suite

Tests are located in `tests/test_square_points.py` and can be run with:

```bash
pytest tests/test_square_points.py -v
```

or via the convenience scripts:

```bat
scripts\run_tests.bat       # Windows
```
```bash
bash scripts/run_tests.sh   # Linux / macOS
```

### Main test classes

**`TestSampleBySideFix`** — specifically verifies the bug fix in `sample_by_side`:
- `test_same_side_allowed`: checks that pairs of points on the same side are
  generated (before the fix this never happened)
- `test_side_distribution_is_balanced`: verifies that the frequency per side is
  in the range 18–32% over 4000 samples (expected 25%)

**Parametric tests on all 9 methods** (via `@pytest.mark.parametrize`):
- `test_returns_two_tuples`: output is in the correct format
- `test_points_on_perimeter`: both points lie on the perimeter
- `test_points_are_distinct`: the two points are not coincident
- `test_works_for_various_L`: L ∈ {0.1, 1, 5, 10, 100, 1000}
- `test_coordinates_within_bounds`: coordinates are in the range [0, L]

**Tests for the `_perimeter_to_xy` helper** (`TestHelperPerimeterToXY`):
- `test_corners`: the four corners of the square
- `test_midpoints`: the midpoints of the four sides
- `test_wrapping`: behaviour with values t > 4L (modulo)

**`TestComparative`** — stress test: 1000 iterations for all 9 methods without errors.

---

## 10. Available Documentation

| File | Location | Content |
|------|----------|---------|
| `index.md` | `docs/index.md` | This document — complete project overview |
| `distance_analysis_report.md` | `docs/distance_analysis_report.md` | Statistical analysis of the 9 methods with numerical results and mathematical interpretation |
| `README.md` | project root | Brief description for quick access |
| `Structure.txt` | project root | Structure documentation (original file, legacy) |

---

## 11. Useful Commands (Makefile)

The project includes a `Makefile` for automating the most common operations.
Run `make` from the `geometry/` folder to see the available targets.

Typical examples:

```bash
make test        # run the full test suite
make run         # run main.py
make clean       # remove __pycache__ and temporary files
```

---

## 12. Technical Notes and Fixed Bugs

### Bug in `sample_by_side` (fixed)

**Problem:** The original condition `while side1 == side2` forced the two points
onto *different sides*, systematically excluding approximately 25% of valid pairs
(those where both points fall on the same side).

**Effect:** The method produced a biased distribution and answered a different
question from the other methods. The bias was detectable but not obvious,
because the percentage >L still came out around 30–35%.

**Empirical verification:** With 10 000 iterations, the original method produced
0 same-side pairs (0.0%); the expected value is ~25%.

**Fix:** The constraint was removed. The two points are now sampled independently,
and rejection only occurs if the points are geometrically coincident (via
`_is_distinct`).

**Test added:** `TestSampleBySideFix.test_same_side_allowed` in
`tests/test_square_points.py` would have caught this bug immediately.

### SyntaxWarning in distance_analysis.py

The Windows path in the docstring of `distance_analysis.py` contained `\S`
(in `\Scripts`), interpreted by Python as an invalid escape sequence.
Fixed by doubling the backslash: `\\Scripts`.

### Renaming from Italian to English identifiers

The original codebase used Italian-style function names (`metodo1` … `metodo6_proiezione`).
All public functions have been renamed to descriptive English identifiers:

| Original name | Current name |
|---------------|--------------|
| `metodo1` | `sample_parametric` |
| `metodo2` | `sample_by_side` |
| `metodo3` | `sample_by_edge_label` |
| `metodo4` | `sample_polar_ray` |
| `metodo5` | `sample_side_pos` |
| `metodo1_alt` | `sample_parametric_modular` |
| `metodo3_alt` | `sample_cartesian` |
| `metodo4_alt` | `sample_polar_angle` |
| `metodo6_proiezione` | `sample_interior_projection` |
